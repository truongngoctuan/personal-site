{"version":3,"sources":["webpack:///./src/components/text-reader/text-helper.js","webpack:///./src/components/text-reader/text-layout.js","webpack:///./src/components/text-reader/pages/reader-main-page.js","webpack:///./src/pages/text-reader.js"],"names":["getTextWidth","text","context","document","canvas","metrics","fontHeight","actualHeight","width","getTextWidthCustom","s","div","body","result","positionInfo","height","console","lineHeight","Math","maxLines","maxHeight","iLine","words","longText","iWord","maxPosition","fitText","lineText","measureLineWithNextWord","fitted","leftOver","ReaderMainPageContent","paragraphs","useState","lines","setLines","fittedParagraphs","setFittedParagraphs","ref","useRef","useEffect","containerWidth","containerHeight","wh","textHeight","formattedParagraphs","fittedContainerHeight","iParagraph","ps","iFittedParagraph","className","key","variant","connect","novels","dispatch","setNovels","type","data","title","path","withPrefix"],"mappings":"wLAQO,SAASA,EAAaC,EAAK,GAEhC,IAGIC,GAFFF,WACCA,SAAsBG,uBAFzB,YAGcC,WAAd,MACAF,SACA,IAAIG,EAAUH,cAPyB,GAUnCI,EACFD,wBAAgCA,EADlC,uBAEIE,EACFF,0BAAkCA,EADpC,yBAGA,MAAO,CACLG,MAAOH,EADF,MAELC,WAFK,EAGLC,gBAIG,SAASE,EAAmBC,EAAE,GACnC,IAAIT,EAAOE,uBAAX,QACAF,cACAA,eACAA,gCAEA,IAAIU,EAAMR,uBAAV,OACAQ,iBAEWR,SAAX,KACAS,eACA,IAAIC,EAAJ,GAEA,IACE,IAAIC,EAAeb,EAAnB,wBACIc,EAASD,EAAb,OAIAD,EAAS,CACPL,MAJUM,EAHV,MAQAP,aAAcQ,GARlB,QAWEZ,6BAGF,OAAOU,E,UCvDF,SAAS,EAAT,SACLG,cAD2D,GAO3D,IAAMC,EAAaC,WAAW,OACxBC,EAAWD,WAAWE,EAA5B,GACAJ,6BACAA,2BAQA,IAPA,IAAIK,EAAJ,EAEIC,EAAQC,QAAZ,KACIC,EAAJ,EACMC,EAAcH,EAApB,OACII,EAAJ,KAEOL,KAAoBG,EAA3B,GAAgD,CAK9C,IAHA,IAAIG,EAAJ,KACIC,EAA0BnB,EAAmBa,EAAD,GAHF,GAKvCE,KAAuBI,QAA9B,GACE,EAGED,GAAY,IAAML,EAAlBK,GAFAA,EAAWL,EAAXK,GAMFC,EAA0BnB,EACxBkB,MAAiBL,IAFnBE,GAPsE,GAcxER,YAAY,YAAZA,GAEA,EAGEU,GAAW,IAAXA,EAFAA,IAKFL,IAGF,IAAMR,EAAS,CACbZ,KADa,EAEbc,OAAQE,EAAaI,GAGvB,MAAO,CACLQ,OADK,EAELC,SAAU,CACR7B,KADQ,GAERc,OAAQK,EAAYP,EAAOE,SCnDjC,IAAMgB,EAAwB,SAAC,GAAoB,IAAlBC,EAAiB,EAAjBA,WAAiB,EACtBC,mBADsB,GACzCC,EADyC,KAClCC,EADkC,OAEAF,mBAFA,GAEzCG,EAFyC,KAEvBC,EAFuB,KAI1CC,EAAMC,iBAAZ,MACAC,qBAAU,WACR,IAAMC,EAAiBH,UAAcA,UAAdA,YAAvB,EACMI,EAAkBJ,UAAcA,UAAdA,aAAxB,EACAtB,sCACAA,uCAEA,IAEM2B,EAAK3C,EAAagC,EAAD,GAFvB,aAGAhB,eAEA,IAAM4B,EAAa1B,WAAnB,KAA8ByB,gBAExBT,EAAQhB,WAAWwB,EAAzB,GACA1B,wBACAmB,KAIA,IAFA,IAAIU,EAAJ,GACIC,EAAJ,EACSC,EAAT,EAAyBA,EAAaf,EAAtC,OAAyDe,IAAc,CACrE,IAEMlC,EAASa,EAFGM,EAAlB,GAdF,YAgBwB,EAAtB,GAMAa,OAAyBhC,SAAzBgC,MACAC,GAAyBjC,SAAzBiC,OAEA9B,qCAEFqB,OACC,CAACC,EAlCJE,UAqCA,IADA,IAAIQ,EAAJ,GACSC,EAAT,EAA+BA,EAA/B,EAAyDA,IACvDD,OACE,uBAAGE,UAAH,iBAA8BC,IAAKF,GAChCb,EAFLY,KAOF,OACE,yBAAKE,UAAU,kDACb,uBAAYA,UAAZ,OAA6BE,QAAQ,MADvC,4CAIE,yBAAKF,UAAL,uCAAsDZ,IAAKA,GAL/D,KAuBFP,eAAqC,CACnCC,WAAY,CAAC,+CAAD,i6GAUd,IAQeqB,eARS,SAAC,GACvB,MAAO,CAAEC,OAD6B,EAAbA,WAIA,SAACC,GAC1B,MAAO,CAAEC,UAAW,mBAAUD,EAAS,CAAEE,KAAF,iBAA0BC,aAGpDL,CAAf,G,wBChFA,UAZgB,kBACd,2BACE,uBAAKM,MAAM,iBACX,yBAAKT,UAAU,kBACb,4BAAQA,UAAU,kBAChB,qBAAuBU,KAAMC,qBAAW,kBACxC,qBAAuBD,KAAMC,qBAAW,wC","file":"component---src-pages-text-reader-js-9539d392e2bcd00eca11.js","sourcesContent":["/**\r\n * Uses canvas.measureText to compute and return the width of the given text of given font in pixels.\r\n *\r\n * @param {String} text The text to be rendered.\r\n * @param {String} font The css font descriptor that text is to be rendered with (e.g. \"bold 14px verdana\").\r\n *\r\n * @see https://stackoverflow.com/questions/118241/calculate-text-width-with-javascript/21015393#21015393\r\n */\r\nexport function getTextWidth(text, font) {\r\n  // re-use canvas object for better performance\r\n  var canvas =\r\n    getTextWidth.canvas ||\r\n    (getTextWidth.canvas = document.createElement(\"canvas\"));\r\n  var context = canvas.getContext(\"2d\");\r\n  context.font = font;\r\n  var metrics = context.measureText(text);\r\n  // console.log(\"full metrics\", metrics)\r\n\r\n  let fontHeight =\r\n    metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent;\r\n  let actualHeight =\r\n    metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;\r\n\r\n  return {\r\n    width: metrics.width,\r\n    fontHeight,\r\n    actualHeight,\r\n  };\r\n}\r\n\r\nexport function getTextWidthCustom(s, font) {\r\n  var text = document.createElement(\"span\");\r\n  text.innerHTML = s;\r\n  text.style.font = font;\r\n  text.style[\"white-space\"] = \"nowrap\";\r\n\r\n  var div = document.createElement(\"div\");\r\n  div.appendChild(text);\r\n\r\n  var body = document.body;\r\n  body.appendChild(div);\r\n  let result = {};\r\n\r\n  try {\r\n    var positionInfo = text.getBoundingClientRect();\r\n    var height = positionInfo.height;\r\n    var width = positionInfo.width;\r\n    // console.log(width);\r\n    // console.log(height);\r\n    result = {\r\n      width,\r\n      actualHeight: height,\r\n    };\r\n  } finally {\r\n    document.body.removeChild(div);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport function getTextHeight(font, s) {\r\n  s = s || \"Hg\";\r\n\r\n  var text = document.createElement(\"span\");\r\n  text.innerHTML = s;\r\n  text.style.font = font;\r\n  // var text = $('<span>'+s+'</span>').css({ font: font });\r\n\r\n  var block = document.createElement(\"div\");\r\n  block.style.display = \"inline-block\";\r\n  block.style.width = \"1px\";\r\n  block.style.height = \"0px\";\r\n  // var block = $('<div style=\"display: inline-block; width: 1px; height: 0px;\"></div>');\r\n\r\n  var div = document.createElement(\"div\");\r\n  div.appendChild(text);\r\n  div.appendChild(block);\r\n  // var div = $('<div></div>');\r\n  // div.append(text, block);\r\n\r\n  var body = document.body;\r\n  body.appendChild(div);\r\n  // var body = $('body');\r\n  // body.append(div);\r\n\r\n  try {\r\n    var result = {};\r\n\r\n    block.style[\"vertical-align\"] = \"baseline\";\r\n    // block.css({ verticalAlign: 'baseline' });\r\n    result.ascent = block.offsetTop - text.offsetTop;\r\n    // result.ascent = block.offset().top - text.offset().top;\r\n\r\n    block.style[\"vertical-align\"] = \"bottom\";\r\n    // block.css({ verticalAlign: 'bottom' });\r\n    result.height = block.offsetTop - text.offsetTop;\r\n    // result.height = block.offset().top - text.offset().top;\r\n\r\n    result.descent = result.height - result.ascent;\r\n  } finally {\r\n    document.body.removeChild(div);\r\n    // div.remove();\r\n  }\r\n\r\n  return result;\r\n}\r\n","import { getTextWidthCustom } from \"./text-helper\";\r\n\r\nexport function fitText(longText, font, maxWidth, maxHeight) {\r\n  console.log(maxWidth, maxHeight);\r\n  // const lineHeight =\r\n  //   Math.floor(getTextWidthCustom(\r\n  //     \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\",\r\n  //     font\r\n  //   ).actualHeight * 1.43);\r\n  const lineHeight = Math.floor(18 * 1.43);\r\n  const maxLines = Math.floor(maxHeight / lineHeight);\r\n  console.log(\"line height\", lineHeight);\r\n  console.log(\"max lines\", maxLines);\r\n  let iLine = 0;\r\n\r\n  let words = longText.split(\" \");\r\n  let iWord = 0;\r\n  const maxPosition = words.length;\r\n  let fitText = null;\r\n\r\n  while (iLine < maxLines && iWord < maxPosition) {\r\n    // calculate break point\r\n    let lineText = null;\r\n    let measureLineWithNextWord = getTextWidthCustom(words[iWord], font);\r\n    // console.log(\" w: \" + words[iWord] + \" \" + measureLineWithNextWord.width);\r\n    while (iWord < maxPosition && measureLineWithNextWord.width < maxWidth) {\r\n      if (!lineText) {\r\n        lineText = words[iWord];\r\n      } else {\r\n        lineText += \" \" + words[iWord];\r\n      }\r\n      // console.log(\" line width\", lineWidth)\r\n      iWord++;\r\n      measureLineWithNextWord = getTextWidthCustom(\r\n        lineText + \" \" + words[iWord],\r\n        font\r\n      );\r\n      // console.log(\" w: \" + words[iWord] + \" \" + measureNextWord.width);\r\n    }\r\n    console.log(`l ${iLine}: ` + lineText);\r\n\r\n    if (!fitText) {\r\n      fitText = lineText;\r\n    } else {\r\n      fitText += \" \" + lineText;\r\n    }\r\n\r\n    iLine++;\r\n  }\r\n\r\n  const result = {\r\n    text: fitText,\r\n    height: lineHeight * iLine,\r\n  };\r\n\r\n  return {\r\n    fitted: result,\r\n    leftOver: {\r\n      text: \"\",\r\n      height: maxHeight - result.height,\r\n    },\r\n  };\r\n}\r\n","import React, { useRef, useEffect, useState } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport { connect } from \"react-redux\";\r\nimport { Typography } from \"@material-ui/core\";\r\nimport \"./reader-main-page.css\";\r\nimport { getTextWidth } from \"../text-helper\";\r\nimport { fitText } from \"../text-layout\";\r\n\r\nconst ReaderMainPageContent = ({ paragraphs }) => {\r\n  const [lines, setLines] = useState(0);\r\n  const [fittedParagraphs, setFittedParagraphs] = useState(0);\r\n\r\n  const ref = useRef(null);\r\n  useEffect(() => {\r\n    const containerWidth = ref.current ? ref.current.offsetWidth : 0;\r\n    const containerHeight = ref.current ? ref.current.offsetHeight : 0;\r\n    console.log(\"container text width\", containerWidth);\r\n    console.log(\"container text height\", containerHeight);\r\n\r\n    const font = \"18px Lato\";\r\n\r\n    const wh = getTextWidth(paragraphs[0], font);\r\n    console.log(wh);\r\n\r\n    const textHeight = Math.floor(wh.actualHeight * 1.43);\r\n\r\n    const lines = Math.floor(containerHeight / textHeight);\r\n    console.log(\"lines \", lines);\r\n    setLines(lines);\r\n\r\n    let formattedParagraphs = [];\r\n    let fittedContainerHeight = containerHeight;\r\n    for (let iParagraph = 0; iParagraph < paragraphs.length; iParagraph++) {\r\n      const paragraph = paragraphs[iParagraph];\r\n\r\n      const result = fitText(\r\n        paragraph,\r\n        font,\r\n        containerWidth,\r\n        fittedContainerHeight\r\n      );\r\n      formattedParagraphs.push(result.fitted.text);\r\n      fittedContainerHeight -= result.fitted.height;\r\n\r\n      console.log(\"fitted text results\", result);\r\n    }\r\n    setFittedParagraphs(formattedParagraphs);\r\n  }, [ref.current]);\r\n\r\n  let ps = [];\r\n  for (let iFittedParagraph = 0; iFittedParagraph < lines; iFittedParagraph++) {\r\n    ps.push(\r\n      <p className=\"text-displayed\" key={iFittedParagraph}>\r\n        {fittedParagraphs[iFittedParagraph]}\r\n      </p>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"text-display flex-grow flex flex-col px-2 py-2\">\r\n      <Typography className=\"mb-4\" variant=\"h4\">\r\n        Chapper 1: Curabitur eu venenatis mauris\r\n      </Typography>\r\n      <div className=\"text-display--main-content flex-grow\" ref={ref}>\r\n        {/* <div><span>asdf</span></div> */}\r\n        {/* <p className=\"text-displayed\"><span>magnaa</span></p> */}\r\n        {/* {<p className=\"text-displayed\">{fittedParagraphs}</p>} */}\r\n        {ps}\r\n        {/* <div>{paragraphs[0]}</div>\r\n        {paragraphs.map((para, idx) => (\r\n          <Typography key={idx}>{para}</Typography>\r\n        ))} */}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nReaderMainPageContent.propTypes = {\r\n  data: PropTypes.array,\r\n};\r\n\r\nReaderMainPageContent.defaultProps = {\r\n  paragraphs: [\r\n    \"Lorem ipsum dolor sit, consectetur adipisci.\",\r\n    \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce magna ipsum, semper ornare laoreet non, cursus in nunc. Fusce rhoncus augue eu elit dignissim, in elementum turpis euismod. Etiam in massa a tortor hendrerit porttitor. Duis mattis convallis convallis. Sed et pretium nisl. Maecenas in ultricies odio, sit amet congue dolor. Morbi leo dui, accumsan sed consectetur venenatis, maximus nec odio. Donec mattis nunc id ultricies ullamcorper. Vestibulum viverra in dui sed lobortis. Mauris fermentum, tortor at egestas faucibus, nulla quam consectetur nunc, a vulputate purus ex at metus.\",\r\n    \"Suspendisse fermentum porta libero laoreet pellentesque. Aliquam a dolor sed mi euismod ornare in non sapien. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nam tempus, nulla malesuada condimentum porta, metus dolor consectetur erat, et lacinia sem dolor in risus. Vestibulum ac ligula feugiat, vestibulum ante vitae, semper diam. Sed justo purus, eleifend sit amet aliquam non, interdum eget dui. Nunc a ipsum nec elit accumsan gravida vel et felis. Fusce augue velit, cursus non gravida at, pellentesque in tortor. Aliquam suscipit egestas sem, quis feugiat est gravida sed. Mauris luctus iaculis lacinia. Nam lacinia, arcu sed scelerisque iaculis, nunc ipsum scelerisque nibh, a euismod urna velit at orci. Suspendisse in turpis sed erat finibus convallis in eu elit. Quisque pulvinar, erat at finibus molestie, ligula eros luctus sapien, consequat pharetra sem enim ut ligula. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nulla sed condimentum ex.\",\r\n    \"Morbi in velit maximus, pretium nulla et, pharetra turpis. Curabitur eu venenatis mauris, eu pharetra nunc. Fusce at porttitor nibh. Suspendisse potenti. Fusce nulla nunc, euismod a pretium vitae, ornare non velit. Nam convallis tincidunt urna, in molestie nisl gravida et. Curabitur lobortis elementum facilisis.\",\r\n    \"Aenean volutpat sollicitudin eleifend. Donec dignissim finibus elit, a venenatis urna volutpat bibendum. Proin mattis volutpat lorem sed accumsan. Maecenas maximus sapien sit amet lectus luctus, nec mollis odio posuere. Donec et vulputate velit. Etiam ut maximus metus. Phasellus sed orci sed nunc placerat vestibulum. Ut laoreet tempus ante, eget finibus nisl sollicitudin vel. Quisque dapibus tempus tellus, ut iaculis elit consequat vitae. Duis id nunc metus. Phasellus volutpat, tellus eu aliquam faucibus, lorem lacus auctor leo, eget semper mi diam nec lectus. Etiam quis dignissim dui, nec tincidunt mi. Aenean gravida dapibus lectus eget eleifend. Nullam viverra risus nec elit malesuada, et ultrices diam bibendum.\",\r\n    \"Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse feugiat erat feugiat metus imperdiet, vel egestas enim elementum. Cras dignissim molestie neque sed malesuada. Sed magna libero, aliquet nec nisi et, aliquet fermentum est. Maecenas nec ante sed lorem consectetur scelerisque in ac libero. Fusce commodo, dolor non fermentum tincidunt, libero purus rutrum nunc, et luctus ante ante at sapien. Morbi consequat feugiat ligula, vitae euismod arcu. Etiam sem dolor, rutrum sit amet risus in, lobortis venenatis ipsum. Cras venenatis, felis vitae scelerisque facilisis, nibh enim dictum mi, in commodo mauris mi nec ipsum. Donec pretium imperdiet massa, eget condimentum neque pretium id. In quam tellus, viverra eu tincidunt ut, porta sed massa.\",\r\n  ],\r\n};\r\n\r\nconst mapStateToProps = ({ novels }) => {\r\n  return { novels };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return { setNovels: (data) => dispatch({ type: `NOVEL-GET-LIST`, data }) };\r\n};\r\n\r\nexport default connect(\r\n  mapStateToProps,\r\n  mapDispatchToProps\r\n)(ReaderMainPageContent);\r\n","import React from \"react\";\r\nimport { Router } from \"@reach/router\";\r\n\r\nimport SEO from \"../components/seo\";\r\nimport ReaderMainPageContent from \"../components/text-reader/pages/reader-main-page\";\r\nimport { withPrefix } from \"gatsby\";\r\nimport AppLayout from \"../components/app-layout\";\r\n\r\nconst AppPage = () => (\r\n  <AppLayout>\r\n    <SEO title=\"novel reader\" />\r\n    <div className=\"flex-grow flex\">\r\n      <Router className=\"flex-grow flex\">\r\n        <ReaderMainPageContent path={withPrefix(\"/text-reader\")} />\r\n        <ReaderMainPageContent path={withPrefix(\"/text-reader/reader-main-page\")} />\r\n      </Router>\r\n    </div>\r\n  </AppLayout>\r\n);\r\n\r\nexport default AppPage;\r\n"],"sourceRoot":""}